<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Construc</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style-base.css">
<link rel="stylesheet" href="style-components.css">
<link rel="stylesheet" href="mobile.css">
</head>
<body>
  <div class="color-dots"></div>
  
  <div class="app">
    <aside class="sidebar" aria-label="Navigasi utama">
      <!-- Desktop Brand -->
      <div class="brand">
        <div class="logo">CC</div>
        <div>
          <h1>ConcreteCalc</h1>
          <p class="muted">UI Disempurnakan</p>
        </div>
      </div>

      <!-- Desktop Navigation -->
      <nav class="nav" role="navigation" aria-label="Primary">
        <button class="nav-btn active" data-target="balok">
          Balok
        </button>
        <button class="nav-btn" data-target="kolom">
          Kolom
        </button>
        <button class="nav-btn" data-target="pelat">
          Pelat
        </button>
        <button class="nav-btn" data-target="fondasi">
          Fondasi
        </button>

        <!-- Tombol Pengaturan di bagian bawah sidebar -->
        <button class="nav-btn settings-btn" id="settingsBtn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z" />
          </svg>
          Pengaturan
        </button>
      </nav>

      <!-- Mobile Navigation -->
      <div class="mobile-nav-container">
        <div class="mobile-nav-header">
          <div class="mobile-brand">
            <div class="logo">CC</div>
            <div class="mobile-brand-text">
              <h1>ConcreteCalc</h1>
              <p class="muted">UI Disempurnakan</p>
            </div>
          </div>
          
          <div class="mobile-nav-controls">
            <!-- Custom Dropdown -->
            <div class="custom-dropdown" id="customDropdown">
              <div class="dropdown-selected" id="dropdownSelected">
                <span>Balok</span>
              </div>
              <div class="dropdown-options" id="dropdownOptions">
                <div class="dropdown-option active" data-value="balok">Balok</div>
                <div class="dropdown-option" data-value="kolom">Kolom</div>
                <div class="dropdown-option" data-value="pelat">Pelat</div>
                <div class="dropdown-option" data-value="fondasi">Fondasi</div>
              </div>
            </div>
            
            <button class="mobile-settings-btn" id="mobileSettingsBtn">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </aside>

    <main class="main" role="main">
      <div class="main-header">
        <div>
          <!-- PERUBAHAN: Header disederhanakan -->
          <div class="main-title">PERHITUNGAN TULANGAN</div>
          <div class="main-sub" id="currentModuleName">Balok</div>
        </div>
        <div class="mode-toggle-container">
          <!-- Tombol Tips di samping kiri toggle - DIREVISI: Hapus data-tips -->
          <button class="circle-tips-btn" id="mainTipsBtn" title="Tips Mode Desain & Evaluasi">?</button>
          
          <!-- Enhanced Mode Toggle - Diperbaiki untuk mobile -->
          <div class="mode-toggle">
            <button data-mode="desain" class="active" id="desainModeBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2" />
              </svg>
              Desain
            </button>
            <button data-mode="evaluasi" id="evaluasiModeBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
              </svg>
              Evaluasi
            </button>
          </div>
        </div>
      </div>

      <div class="content" id="contentRoot">
        <section class="panel-col">
          <!-- Quick Inputs Card - dipindah ke atas -->
          <div class="quick-inputs-card">
            <div class="card-header-with-tips">
              <h3>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" 
                    viewBox="0 0 24 24" fill="none" stroke="currentColor" 
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" 
                    class="lucide lucide-boxes">
                  <path d="M2.97 12.92A2 2 0 0 0 2 14.63v3.24a2 2 0 0 0 .97 1.71l3 1.8a2 2 0 0 0 2.06 0L12 19v-5.5l-5-3-4.03 2.42Z"/>
                  <path d="m7 16.5-4.74-2.85"/>
                  <path d="m7 16.5 5-3"/>
                  <path d="M7 16.5v5.17"/>
                  <path d="M12 13.5V19l3.97 2.38a2 2 0 0 0 2.06 0l3-1.8a2 2 0 0 0 .97-1.71v-3.24a2 2 0 0 0-.97-1.71L17 10.5l-5 3Z"/>
                  <path d="m17 16.5-5-3"/>
                  <path d="m17 16.5 4.74-2.85"/>
                  <path d="M17 16.5v5.17"/>
                  <path d="M7.97 4.42A2 2 0 0 0 7 6.13v4.37l5 3 5-3V6.13a2 2 0 0 0-.97-1.71l-3-1.8a2 2 0 0 0-2.06 0l-3 1.8Z"/>
                  <path d="M12 8 7.26 5.15"/>
                  <path d="m12 8 4.74-2.85"/>
                  <path d="M12 13.5V8"/>
                </svg>
                Data Material
              </h3>

              <!-- DIREVISI: Tips Data Material yang baru -->
              <button class="circle-tips-btn" data-tips="f'c ‚Äî Gunakan nilai sesuai mutu beton yang direncanakan. Umumnya 20‚Äì40 MPa untuk beton bertulang biasa.

fy ‚Äî Gunakan nilai leleh baja tulangan utama. Nilai umum yang digunakan antara 240 MPa sampai 500 MPa.

fyt ‚Äî Gunakan nilai leleh baja begel. Nilai umum yang digunakan antara 240 MPa sampai 400 MPa, atau biasanya disamakan dengan tulangan utama.

…£c ‚Äî Berat jenis beton normal sekitar 24 kN/m¬≥. Sesuaikan jika ada perbedaan spesifikasi beton.">?</button>
            </div>
            <div class="quick-inputs-grid">
              <div class="quick-field">
                <label>f'<sub>c</sub></label>
                <div class="input-with-unit" data-unit="MPa">
                  <input id="quickFc" placeholder="Kuat Tekan Beton">
                </div>
              </div>
              <div class="quick-field">
                <label>f<sub>y</sub></label>
                <div class="input-with-unit" data-unit="MPa">
                  <input id="quickFy" placeholder="Kuat Leleh Baja">
                </div>
              </div>
              <div class="quick-field" id="fytField" style="display: none;">
                <label>f<sub>yt</sub></label>
                <div class="input-with-unit" data-unit="MPa">
                  <input id="quickFyt" placeholder="Kuat Leleh Baja Begel">
                </div>
              </div>
              <div class="quick-field" id="gammaCField" style="display: none;">
                <label>…£<sub>c</sub></label>
                <div class="input-with-unit" data-unit="kN/m¬≥">
                  <input id="quickGammaC" placeholder="Berat Jenis Beton">
                </div>
              </div>
            </div>
            <!-- Tombol dihapus sesuai permintaan -->
          </div>

          <!-- Panel: Module Form (dynamic content rendered by JS) -->
          <div id="moduleForm" class="card">
            <!-- content injected by JS -->
          </div>
          
          <!-- Panel Actions - DIPINDAH KE LUAR CARD -->
          <div class="panel-actions">
            <button class="btn ghost" id="saveDraftBtn">Simpan Draft</button>
            <button class="btn primary" id="calculateBtn">Hitung Desain</button>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- Settings Modal -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal">
      <div class="modal-header">
        <h2>Pengaturan</h2>
        <button class="close-modal" id="closeModalBtn">&times;</button>
      </div>
      <div class="modal-content">
        <!-- General Section -->
        <div class="segmented-section">
          <div class="section-title">üõ†Ô∏è General</div>
          <div class="general-settings">
            <label class="checkbox-label">
              <input type="checkbox" id="rememberModuleCheckbox">
              <span>Remember last opened module</span>
            </label>
            
            <!-- TAMBAHAN: Tombol Reset All Data -->
            <div style="margin-top: 16px;">
              <button class="btn ghost" id="resetAllDataBtn" style="width: 100%;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash2-icon lucide-trash-2">
                  <path d="M10 11v6"/>
                  <path d="M14 11v6"/>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/>
                  <path d="M3 6h18"/>
                  <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                </svg>
                Reset All Data
              </button>
            </div>
          </div>
        </div>
        <hr class="section-divider">

        <!-- Color Section -->
        <div class="segmented-section">
          <div class="section-title">üé® Color</div>
          <div class="color-inputs">
            <div class="color-input">
              <label for="color1">Body BG:</label>
              <input type="color" id="colorPicker1" value="#FFFFFF">
              <input type="text" id="colorInput1" value="#FFFFFF" placeholder="Hex color">
            </div>
            <div class="color-input">
              <label for="color2">Buttons:</label>
              <input type="color" id="colorPicker2" value="#282B53">
              <input type="text" id="colorInput2" value="#282B53" placeholder="Hex color">
            </div>
            <div class="color-input">
              <label for="color3">Borders:</label>
              <input type="color" id="colorPicker3" value="#1C1136">
              <input type="text" id="colorInput3" value="#1C1136" placeholder="Hex color">
            </div>
            <div class="color-input">
              <label for="color4">Labels:</label>
              <input type="color" id="colorPicker4" value="#202242">
              <input type="text" id="colorInput4" value="#202242" placeholder="Hex color">
            </div>
          </div>
        </div>

        <div class="color-actions">
          <button class="btn ghost" id="randomColorsBtn">Random Colors</button>
          <button class="btn ghost" id="resetColorsBtn">Reset</button>
          <button class="btn primary" id="applyColorsBtn">Apply</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Tips Modal -->
  <div class="modal-overlay" id="tipsModal">
    <div class="modal tips-modal">
      <div class="modal-header">
        <h2>Tips & Panduan</h2>
        <button class="close-modal" id="closeTipsModalBtn">&times;</button>
      </div>
      <div class="modal-content">
        <div class="tips-content" id="tipsContent">
          <!-- Content akan diisi oleh JavaScript -->
        </div>
      </div>
    </div>
  </div>
<!-- Alert Modal -->
<div class="modal-overlay" id="alertModal">
  <div class="modal alert-modal">
    <div class="modal-header">
      <h2>‚ÄºÔ∏è Alert</h2>
      <button class="close-modal" id="closeAlertModalBtn">&times;</button>
    </div>
    <div class="modal-content">
      <div class="alert-content" id="alertContent">
        <!-- Content akan diisi oleh JavaScript -->
      </div>
    </div>
  </div>
</div>
  <!-- Load modul JavaScript -->
  <script src="modul-balok.js"></script>
  <script src="modul-kolom.js"></script>
  <script src="modul-pelat.js"></script>
  <script src="modul-fondasi.js"></script>
  <script src="calc-balok.js"></script>
  <script src="optimizer-balok.js"></script>
  <script src="calc-kolom.js"></script>
  <script src="optimizer-kolom.js"></script>
  <script src="calc-pelat.js"></script>
  <script src="optimizer-pelat.js"></script>
  <script src="calc-fondasi.js"></script>
  <script src="optimizer-fondasi.js"></script>
  <script src="script.js"></script>
<script>
// Clear storage hanya ketika membuka index.html
sessionStorage.removeItem('calculationResult');
sessionStorage.removeItem('calculationResultKolom'); 
sessionStorage.removeItem('calculationResultPelat');
sessionStorage.removeItem('calculationResultFondasi'); 
sessionStorage.removeItem('savedDraft');
sessionStorage.removeItem('currentModule');
console.log("üßπ Storage cleared for new session");
</script>
<!-- AUTOFILL SECRET FEATURE - KLIK LOGO 8 KALI -->
<script>
// =========== AUTOFILL SECRET FEATURE ===========
let logoClickCount = 0;
let logoClickTimer = null;

// Data template untuk autofill
const autofillTemplate = {
    "formState": {
        "fondasi": {
            "evaluasi": {
                "terzaghi": true,
                "mayerhoff": true,
                "autoDimensi_tunggal": false,
                "lx_tunggal": "2",
                "ly_tunggal": "2.8",
                "by_tunggal": "400",
                "bx_tunggal": "400",
                "h_tunggal": "0.4",
                "ly_menerus": "13.5",
                "lx_menerus": "1.6",
                "by_menerus": "13500",
                "bx_menerus": "500",
                "h_menerus": "0.25",
                "alpha_s_menerus": "100",
                "alpha_s_tunggal": "Tepi",
                "df": "1.6",
                "phi": "34",
                "gamma": "17.2",
                "c": "20",
                "qc": "95",
                "pu": "384",
                "mux": "251",
                "muy": "0",
                "d": "10",
                "db": "8",
                "s": "95",
                "sb": "100",
                "qa": "489.6"
            },
            "desain": {
                "terzaghi": true,
                "mayerhoff": true,
                "autoDimensi_tunggal": false,
                "ly_tunggal": "2.8",
                "lx_tunggal": "2",
                "h_tunggal": "0.4",
                "by_tunggal": "400",
                "bx_tunggal": "400",
                "alpha_s_tunggal": "Tepi",
                "df": "1.6",
                "gamma": "17.2",
                "phi": "34",
                "c": "20",
                "qc": "95",
                "pu": "384",
                "mux": "254",
                "muy": "0",
                "ly_menerus": "13.5",
                "lx_menerus": "1.6",
                "by_menerus": "13500",
                "bx_menerus": "500",
                "h_menerus": "0.25",
                "alpha_s_menerus": "100",
                "qa": "489.68"
            }
        },
        "balok": {
            "evaluasi": {
                "h": "400",
                "b": "250",
                "sb": "40",
                "left_mu_pos": "0",
                "left_mu_neg": "19.617",
                "center_mu_pos": "28.534",
                "right_mu_pos": "0",
                "right_mu_neg": "19.617",
                "left_vu": "100",
                "center_vu": "100",
                "right_vu": "100",
                "left_tu": "20.96",
                "center_tu": "20.96",
                "right_tu": "20.96",
                "center_mu_neg": "0",
                "d": "19",
                "phi": "8",
                "support_n": "4",
                "support_np": "2",
                "support_nt": "4",
                "support_s": "100",
                "field_n": "4",
                "field_np": "2",
                "field_nt": "4",
                "field_s": "100"
            },
            "desain": {
                "h": "400",
                "b": "250",
                "sb": "40",
                "left_mu_pos": "36.49",
                "left_mu_neg": "94",
                "left_vu": "100",
                "center_vu": "100",
                "right_vu": "100",
                "left_tu": "20",
                "center_tu": "20",
                "right_tu": "20",
                "center_mu_pos": "40.65",
                "center_mu_neg": "0",
                "right_mu_pos": "65.92",
                "right_mu_neg": "110.03"
            }
        },
        "kolom": {
            "desain": {
                "h": "700",
                "b": "600",
                "sb": "40",
                "pu": "1200",
                "mu": "650",
                "vu": "274.29"
            },
            "evaluasi": {
                "h": "700",
                "b": "600",
                "sb": "40",
                "pu": "1200",
                "mu": "650",
                "vu": "274.29",
                "d": "29",
                "phi": "10",
                "n": "12",
                "s": "220"
            }
        },
        "pelat": {
            "desain": {
                "beban_tp": "Terjepit Penuh",
                "qu": "10",
                "ly": "6",
                "lx": "4",
                "h": "120",
                "sb": "20",
                "pattern_boxes": {
                    "top": false,
                    "right": false
                },
                "mu": "12.16",
                "beban_tp_manual": ""
            },
            "evaluasi": {
                "ly": "6",
                "lx": "4",
                "h": "120",
                "sb": "20",
                "beban_tp": "Terjepit Penuh",
                "qu": "10",
                "d": "10",
                "db": "8",
                "s": "155",
                "mu": "12.16",
                "sb_tulangan": "205",
                "beban_tp_manual": "Dua Arah"
            }
        }
    },
    "quickInputsState": {
        "quickFc": "20",
        "quickFy": "300",
        "quickFyt": "300",
        "quickGammaC": "24"
    },
    "bebanMode": {
        "fondasi": {
            "evaluasi": "menerus",
            "desain": "tunggal"
        },
        "pelat": {
            "desain": "auto",
            "evaluasi": "manual"
        }
    }
};

// Fungsi untuk reset counter
function resetLogoClickCounter() {
    logoClickCount = 0;
    logoClickTimer = null;
}

// Fungsi untuk menyimpan data template ke localStorage
function saveAutofillTemplate() {
    try {
        localStorage.setItem('concretecalc_draft', JSON.stringify(autofillTemplate));
        console.log('üíæ Data template autofill disimpan ke localStorage');
        return true;
    } catch (e) {
        console.error('‚ùå Gagal menyimpan ke localStorage:', e);
        return false;
    }
}

// Fungsi untuk memuat data dari localStorage
function loadAutofillTemplate() {
    try {
        const saved = localStorage.getItem('concretecalc_draft');
        if (saved) {
            return JSON.parse(saved);
        }
    } catch (e) {
        console.error('‚ùå Gagal memuat dari localStorage:', e);
    }
    return null;
}

// Fungsi untuk mengisi data berdasarkan template
function fillFromTemplate(template) {
    if (!template) return;
    
    const currentModule = sessionStorage.getItem('currentModule') || 'balok';
    const currentMode = document.querySelector('.mode-toggle button.active')?.dataset.mode || 'desain';
    
    console.log(`üîÑ Mengisi data untuk modul: ${currentModule}, mode: ${currentMode}`);
    
    // 1. Isi Quick Inputs
    if (template.quickInputsState) {
        for (const [key, value] of Object.entries(template.quickInputsState)) {
            const input = document.getElementById(key);
            if (input) {
                input.value = value;
                input.dispatchEvent(new Event('change'));
            }
        }
    }
    
    // 2. Isi Data Modul
    const moduleData = template.formState?.[currentModule]?.[currentMode];
    if (moduleData) {
        // Untuk setiap field di moduleData
        for (const [field, value] of Object.entries(moduleData)) {
            let input;
            
            // Coba cari input dengan berbagai kemungkinan ID
            const possibleIds = [
                field,
                `input${field.charAt(0).toUpperCase() + field.slice(1)}`,
                `input${field}`,
                `input_${field}`,
                `select${field.charAt(0).toUpperCase() + field.slice(1)}`
            ];
            
            for (const id of possibleIds) {
                input = document.getElementById(id);
                if (input) break;
            }
            
            if (input) {
                // Handle tipe input yang berbeda
                if (input.type === 'checkbox') {
                    input.checked = Boolean(value);
                } else if (input.type === 'radio') {
                    // Untuk radio button, cari yang value-nya sesuai
                    const radios = document.querySelectorAll(`input[name="${input.name}"][value="${value}"]`);
                    if (radios.length > 0) {
                        radios[0].checked = true;
                    }
                } else if (input.tagName === 'SELECT') {
                    input.value = value;
                } else {
                    input.value = value;
                }
                
                // Trigger change event
                input.dispatchEvent(new Event('change'));
            }
        }
        
        // 3. Handle kasus khusus untuk pattern_boxes di modul pelat
        if (currentModule === 'pelat' && moduleData.pattern_boxes) {
            setTimeout(() => {
                const patternBoxes = moduleData.pattern_boxes;
                // Klik kotak pattern jika perlu
                document.querySelectorAll('.pattern-box-clickable').forEach(box => {
                    const position = box.classList.contains('pattern-box-top') ? 'top' :
                                   box.classList.contains('pattern-box-right') ? 'right' :
                                   box.classList.contains('pattern-box-left') ? 'left' :
                                   box.classList.contains('pattern-box-bottom') ? 'bottom' : null;
                    
                    if (position && patternBoxes[position] === false) {
                        // Jika di template false, klik untuk menjadikannya plain
                        if (!box.classList.contains('pattern-box-plain')) {
                            box.click();
                        }
                    }
                });
            }, 100);
        }
    }
}

// Fungsi untuk memicu autofill
function triggerAutofill() {
    // Simpan template ke localStorage
    const saved = saveAutofillTemplate();
    
    if (saved) {
        // Muat template dari localStorage
        const template = loadAutofillTemplate();
        if (template) {
            // Isi data dari template
            fillFromTemplate(template);
            
            // Tampilkan notifikasi
            showAutofillNotification('Data testing dimuat dari template!');
        } else {
            showAutofillNotification('Gagal memuat template!');
        }
    } else {
        showAutofillNotification('Gagal menyimpan template!');
    }
}

// Fungsi untuk menampilkan notifikasi autofill
function showAutofillNotification(message) {
    // Buat elemen notifikasi jika belum ada
    let notification = document.getElementById('autofillNotification');
    if (!notification) {
        notification = document.createElement('div');
        notification.id = 'autofillNotification';
        notification.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--color-buttons);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 9999;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            font-family: 'Inter', sans-serif;
            text-align: center;
            max-width: 80%;
        `;
        document.body.appendChild(notification);
    }
    
    // Tampilkan notifikasi
    notification.textContent = message || 'Autofill diaktifkan! Mengisi data testing...';
    notification.style.opacity = '1';
    
    // Sembunyikan setelah 2 detik
    setTimeout(() => {
        notification.style.opacity = '0';
    }, 2000);
}

// Fungsi untuk menangani klik logo
function handleLogoClick() {
    logoClickCount++;
    
    // Reset timer jika ada
    if (logoClickTimer) {
        clearTimeout(logoClickTimer);
    }
    
    // Set timer untuk reset counter setelah 1.5 detik
    logoClickTimer = setTimeout(resetLogoClickCounter, 1500);
    
    // Jika sudah 8 klik, trigger autofill
    if (logoClickCount >= 8) {
        triggerAutofill();
        resetLogoClickCounter();
    }
}

// Inisialisasi event listener untuk logo
document.addEventListener('DOMContentLoaded', function() {
    // Logo desktop
    const brandLogo = document.querySelector('.brand');
    if (brandLogo) {
        // HAPUS: brandLogo.style.cursor = 'pointer'; // Tidak mengubah cursor
        brandLogo.addEventListener('click', handleLogoClick);
    }
    
    // Logo mobile
    const mobileBrandLogo = document.querySelector('.mobile-brand');
    if (mobileBrandLogo) {
        // HAPUS: mobileBrandLogo.style.cursor = 'pointer'; // Tidak mengubah cursor
        mobileBrandLogo.addEventListener('click', handleLogoClick);
    }
    
    console.log('üîê Autofill secret feature siap! Klik logo 8 kali cepat untuk mengisi data testing.');
    console.log('üìÅ Data akan disimpan di localStorage dengan key: concretecalc_draft');
});

// Tambahkan fungsi autofill untuk setiap modul (jika diperlukan oleh modul lain)
// Fungsi-fungsi ini bisa dipanggil dari modul masing-masing
function autofillBalok() {
    const template = loadAutofillTemplate();
    if (template) {
        const currentMode = document.querySelector('.mode-toggle button.active')?.dataset.mode || 'desain';
        const moduleData = template.formState?.balok?.[currentMode];
        
        // Isi field khusus balok jika ada
        if (moduleData) {
            // Contoh: isi field yang spesifik
            const mapping = {
                'h': 'inputH',
                'b': 'inputB',
                'sb': 'inputCover',
                'd': 'inputDiaTul',
                'phi': 'inputDiaBegel'
            };
            
            for (const [dataKey, fieldId] of Object.entries(mapping)) {
                if (moduleData[dataKey]) {
                    const input = document.getElementById(fieldId);
                    if (input) {
                        input.value = moduleData[dataKey];
                        input.dispatchEvent(new Event('change'));
                    }
                }
            }
        }
    }
}

function autofillKolom() {
    const template = loadAutofillTemplate();
    if (template) {
        const currentMode = document.querySelector('.mode-toggle button.active')?.dataset.mode || 'desain';
        const moduleData = template.formState?.kolom?.[currentMode];
        
        if (moduleData) {
            const mapping = {
                'h': 'inputH_kolom',
                'b': 'inputB_kolom',
                'sb': 'inputCover_kolom',
                'pu': 'inputPu_kolom',
                'mu': 'inputMu_kolom',
                'vu': 'inputVu_kolom',
                'd': 'inputDiaTul_kolom',
                'phi': 'inputDiaBegel_kolom',
                'n': 'inputN_kolom',
                's': 'inputS_kolom'
            };
            
            for (const [dataKey, fieldId] of Object.entries(mapping)) {
                if (moduleData[dataKey]) {
                    const input = document.getElementById(fieldId);
                    if (input) {
                        input.value = moduleData[dataKey];
                        input.dispatchEvent(new Event('change'));
                    }
                }
            }
        }
    }
}

function autofillPelat() {
    const template = loadAutofillTemplate();
    if (template) {
        const currentMode = document.querySelector('.mode-toggle button.active')?.dataset.mode || 'desain';
        const moduleData = template.formState?.pelat?.[currentMode];
        
        if (moduleData) {
            const mapping = {
                'ly': 'inputLy_pelat',
                'lx': 'inputLx_pelat',
                'h': 'inputH_pelat',
                'sb': 'inputCover_pelat',
                'qu': 'inputQu_pelat',
                'mu': 'inputMu_pelat',
                'd': 'inputDiaTul_pelat',
                'db': 'inputDiaBegel_pelat',
                's': 'inputS_pelat',
                'sb_tulangan': 'inputSbTulangan_pelat'
            };
            
            for (const [dataKey, fieldId] of Object.entries(mapping)) {
                if (moduleData[dataKey]) {
                    const input = document.getElementById(fieldId);
                    if (input) {
                        input.value = moduleData[dataKey];
                        input.dispatchEvent(new Event('change'));
                    }
                }
            }
            
            // Handle dropdowns
            if (moduleData.beban_tp) {
                const select = document.getElementById('selectBebanTp');
                if (select) {
                    select.value = moduleData.beban_tp;
                    select.dispatchEvent(new Event('change'));
                }
            }
            
            if (moduleData.beban_tp_manual) {
                const select = document.getElementById('selectBebanTpManual');
                if (select) {
                    select.value = moduleData.beban_tp_manual;
                    select.dispatchEvent(new Event('change'));
                }
            }
        }
    }
}

function autofillFondasi() {
    const template = loadAutofillTemplate();
    if (template) {
        const currentMode = document.querySelector('.mode-toggle button.active')?.dataset.mode || 'desain';
        const moduleData = template.formState?.fondasi?.[currentMode];
        
        if (moduleData) {
            // Isi field umum fondasi
            const generalMapping = {
                'df': 'inputDf',
                'phi': 'inputPhi',
                'gamma': 'inputGamma',
                'c': 'inputC',
                'qc': 'inputQc',
                'pu': 'inputPu',
                'mux': 'inputMux',
                'muy': 'inputMuy',
                'qa': 'inputQa',
                'd': 'inputD',
                'db': 'inputDb',
                's': 'inputS',
                'sb': 'inputSb'
            };
            
            for (const [dataKey, fieldId] of Object.entries(generalMapping)) {
                if (moduleData[dataKey]) {
                    const input = document.getElementById(fieldId);
                    if (input) {
                        input.value = moduleData[dataKey];
                        input.dispatchEvent(new Event('change'));
                    }
                }
            }
            
            // Handle checkbox
            if (moduleData.terzaghi !== undefined) {
                const checkbox = document.getElementById('checkTerzaghi');
                if (checkbox) {
                    checkbox.checked = moduleData.terzaghi;
                    checkbox.dispatchEvent(new Event('change'));
                }
            }
            
            if (moduleData.mayerhoff !== undefined) {
                const checkbox = document.getElementById('checkMayerhoff');
                if (checkbox) {
                    checkbox.checked = moduleData.mayerhoff;
                    checkbox.dispatchEvent(new Event('change'));
                }
            }
        }
    }
}
</script>
</body>
</html>